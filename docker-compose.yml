services:
  mintd:
    build: ./cdk
    ports:
      - "8085:8085"
    environment:
      CDK_MINTD_URL: "http://localhost:8085"
      CDK_MINTD_LN_BACKEND: fakewallet
      CDK_MINTD_LISTEN_HOST: "0.0.0.0"
      CDK_MINTD_LISTEN_PORT: "8085"
      CDK_MINTD_DATABASE: sqlite
      CDK_MINTD_CACHE_BACKEND: memory
      CDK_MINTD_MNEMONIC: "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8085/v1/info"]
      interval: 5s
      timeout: 5s
      retries: 60
      start_period: 30s

  seed:
    build:
      context: .
      dockerfile: tools/seed-conditions/Dockerfile
    environment:
      MINT_URL: "http://mintd:8085"
    depends_on:
      mintd:
        condition: service_healthy

  server:
    build:
      context: .
      dockerfile: BitCaster.Server/Dockerfile
    ports:
      - "5000:5000"
    environment:
      ASPNETCORE_URLS: "http://+:5000"
      Mint__Url: "http://mintd:8085"
    depends_on:
      mintd:
        condition: service_healthy

  frontend:
    build:
      context: .
      dockerfile: bitCaster/Dockerfile
    ports:
      - "5173:80"
    depends_on:
      - server
      - mintd
